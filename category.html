<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Car Touch - Category</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root {
      --bg: #f9fafb;
      --card: #fff;
      --text: #111827;
      --muted: #6b7280;
      --brand: #0a7cff;
    }
    body {
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
    }

    /* HEADER */
    .site-header { padding: 20px 12px; text-align: center; }
    .logo {
      font-weight: 900;
      font-size: clamp(36px, 8vw, 60px);
      display: inline-flex; align-items: center; gap: .5rem;
      color: #062a5f;
      text-decoration: none;
    }
    .logo .wheel {
      width: 1.5em; height: 1.5em; border-radius: 50%;
      border: 4px solid #062a5f; display: inline-block; position: relative;
    }
    .logo .wheel:before {
      content: ""; position: absolute; inset: 4px;
      border: 3px dotted #062a5f; border-radius: 50%;
    }

    /* SECTION */
    .section { padding: 24px 16px; max-width: 1200px; margin: 0 auto; }

    /* CATEGORY TITLE */
    #cat-title {
      margin-bottom: 20px;
      font-weight: 800;
      font-size: clamp(22px, 6vw, 36px);
      text-align: center;
    }

    /* PRODUCTS GRID */
    .prod-grid { 
      display: grid; 
      gap: 20px; 
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
    }
    .prod-card { 
      background: var(--card); 
      border-radius: 16px; 
      overflow: hidden; 
      text-align: center; 
      box-shadow: 0 6px 16px rgba(0,0,0,0.08); 
      transition: transform .2s, box-shadow .2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px;
    }
    .prod-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.12);
    }
    .prod-img-box {
      width: 100%;
      height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f4f4f4;
      border-radius: 12px;
      overflow: hidden;
    }
    .prod-img { 
      max-width: 100%; 
      max-height: 100%; 
      object-fit: contain;
    }
    .prod-name { 
      font-weight: 700; 
      padding: 12px 6px 6px; 
      font-size: 1rem; 
      color: var(--text);
    }

    /* BACK LINK */
    .back-link { 
      display: inline-block; 
      margin-bottom: 20px; 
      text-decoration: none; 
      color: var(--brand); 
      font-weight: 600; 
    }

    /* EMPTY MESSAGE */
    #empty {
      margin-top: 20px;
      display: none;
      font-size: 1.1rem;
      color: var(--muted);
    }

    /* FOOTER */
    .footer {
      margin-top: 40px;
      padding: 24px 16px;
      background: #062a5f;
      color: #fff;
      text-align: center;
    }
    .footer h2 {
      font-weight: 800;
      font-size: 24px;
      margin-bottom: 8px;
    }
    .footer p {
      margin: 4px 0;
      font-size: 15px;
      color: #e5e7eb;
    }
  </style>
</head>
<body>

<header class="site-header">
  <a href="index.html" class="logo">Car T<span class="wheel"></span>uch</a>
</header>

<section class="section">
  <a href="index.html" class="back-link">‚Üê Back to categories</a>
  <h2 id="cat-title"></h2>
  <div id="products" class="prod-grid"></div>
  <div id="empty" class="text-center">No products found.</div>
</section>

<!-- FOOTER -->
<footer class="footer">
  <h2>CAR TOUCH</h2>
  <p>Car Accessories Store</p>
  <p>230/18 NH 19 Krishna Nagar, Govardhan Chauraha, Mathura</p>
  <p>Opp. Jagdish Petrol Pump</p>
</footer>

<script>
  const SHEET_ID = '1t5RY03DIAHApli6Q-pBq7l6fszh9NO3G-plyDwdbv9A';
  const PRODUCTS_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=Products`;

  function driveDirect(url){
    if(!url) return '';
    if(url.includes('drive.google.com')){
      const match = url.match(/[-\w]{25,}/);
      return match ? `https://drive.google.com/uc?export=view&id=${match[0]}` : url;
    }
    return url; // allow S3/other direct links
  }
  function parseGViz(txt){ const s=txt.indexOf('{'); const e=txt.lastIndexOf('}')+1; return JSON.parse(txt.substring(s,e)); }
  async function fetchSheet(url){ const res=await fetch(url); const json=parseGViz(await res.text()); return json.table.rows.map(r=>r.c.map(c=>c?.v||'')); }

  function getQueryParam(name){
    return new URLSearchParams(window.location.search).get(name);
  }

  async function loadProducts(){
    const rows = await fetchSheet(PRODUCTS_URL);
    const products = rows.map(([category,name,image])=>({category,name,image:driveDirect(image)}));
    const slug = getQueryParam('cat');
    const filtered = products.filter(p=>p.category.toLowerCase().replace(/\s+/g,'-')===slug);

    document.getElementById('cat-title').innerText = slug.replace(/-/g,' ').replace(/\b\w/g,c=>c.toUpperCase());

    const grid = document.getElementById('products');
    if(filtered.length===0){
      document.getElementById('empty').style.display='block'; return;
    }
    filtered.forEach(p=>{
      const card=document.createElement('div');
      card.className='prod-card';
      card.innerHTML=`
        <div class="prod-img-box">
          <img class="prod-img" src="${p.image}" alt="${p.name}" loading="lazy" 
          onerror="this.src='https://via.placeholder.com/200x200?text=Image';">
        </div>
        <div class="prod-name">${p.name}</div>`;
      grid.appendChild(card);
    });
  }

  window.addEventListener('DOMContentLoaded', loadProducts);
</script>
</body>
</html>
